<?xml version="1.0" encoding="utf-8"?>
<tnt-data-source
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/Nastel/tnt4j-streams/master/tnt4j-streams-ws/config/tnt-data-source-ws.xsd">

    <resource-ref id="EVENT_CODE_MAPPINGS" type="ValuesMap" uri="b2bi_mappings.json"/>

    <parser name="B2BiAFilesResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="AFile_{0}">
            <field-locator id="AFileKey" locator="AFILE_KEY" locator-type="Label"/>
        </field>
        <field name="EventType" value="EVENT"/>
        <field name="EventName" separator=".">
            <field-locator id="DataFlowId" locator="AFILE_DATA_FLOW_ID" locator-type="Label"/>
            <field-locator id="MailBox" locator="AFILE_MAILBOX_PATH" locator-type="Label"/>
            <field-locator id="FileName" locator="AFILE_FILE_NAME" locator-type="Label"/>
        </field>
        <field name="StartTime" locator="AFILE_CREATETS" locator-type="Label"/>
        <field name="EndTime" locator="AFILE_MODIFYTS" locator-type="Label"/>

        <field name="ApplName" locator="AFILE_CREATEPROGID" locator-type="Label"/>
        <!--field name="ApplName" locator="AFILE_CREATEPROGID" locator-type="Label">
            <field-transform lang="groovy" name="AttrNameTransform"><![CDATA[
                Strings.replace($fieldValue, "filegateway", "");
            ]]></field-transform>
        </field-->

        <field name="ResourceNameTemp" separator="/" transparent="true" datatype="String">
            <field-locator id="MailboxPath" locator="AFILE_MAILBOX_PATH" locator-type="Label" required="false"/>
            <field-locator id="Filename" locator="AFILE_FILE_NAME" locator-type="Label" required="false"/>
        </field>
        <field name="ResourceName" locator="ResourceNameTemp" locator-type="Activity" formattingPattern="FILE={0}"/>

        <field name="MessageId" locator="AFILE_MESSAGE_ID" locator-type="Label" datatype="Number" format="long"/>
        <field name="UserId" locator="AFILE_USER_ID" locator-type="Label"/>
        <field name="FileName" locator="AFILE_FILE_NAME" locator-type="Label"/>
        <field name="FileSize" locator="AFILE_FILE_SIZE" locator-type="Label" datatype="Number" format="long"/>
        <field name="MailboxPath" locator="AFILE_MAILBOX_PATH" locator-type="Label"/>
        <field name="DataFlowId" locator="AFILE_DATA_FLOW_ID" locator-type="Label"/>
        <!--field name="ProdOrgKey" locator="AFILE_PROD_ORG_KEY" locator-type="Label"/-->
        <field name="ProdOrgName" locator="AFILE_PROD_ORG_NAME" locator-type="Label"/>
        <field name="State" locator="AFILE_STATE" locator-type="Label"/>
        <field name="DocumentId" locator="AFILE_DOCUMENT_ID" locator-type="Label"/>
        <field name="WorkflowId" locator="AFILE_WFID" locator-type="Label" datatype="Number" format="long"/>
        <field name="Reviewed" locator="AFILE_REVIEWED" locator-type="Label" datatype="Number" format="integer"/>
        <field name="ReplayAfKey" locator="AFILE_REPLAY_AF_KEY" locator-type="Label"/>
        <field name="ReplayComment" locator="AFILE_REPLAY_COMMENT" locator-type="Label"/>
        <field name="RoutesRemain" locator="AFILE_ROUTES_REMAIN" locator-type="Label" datatype="Number" format="integer"/>
        <field name="LockId" locator="AFILE_LOCKID" locator-type="Label" datatype="Number" format="integer"/>
        <field name="CreateUserId" locator="AFILE_CREATEUSERID" locator-type="Label"/>
        <field name="ModifyUserId" locator="AFILE_MODIFYUSERID" locator-type="Label"/>
        <field name="CreateProgId" locator="AFILE_CREATEPROGID" locator-type="Label"/>
        <field name="ModifyProgId" locator="AFILE_MODIFYPROGID" locator-type="Label"/>
        <field name="DeliveryState" locator="AFILE_DELIVERY_STATE" locator-type="Label"/>
        <field name="DistMsgId" locator="AFILE_DIST_MSG_ID" locator-type="Label"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator">
            <field-locator id="DataFlowId" locator="AFILE_DATA_FLOW_ID" locator-type="Label" required="false"/>
        </field>
        <field name="Correlator" separator=":">
            <field-locator id="DataFlowId" locator="AFILE_DATA_FLOW_ID" locator-type="Label"/>
            <field-locator id="MailBox" locator="AFILE_MAILBOX_PATH" locator-type="Label" required="false"/>
            <field-locator id="FileName" locator="AFILE_FILE_NAME" locator-type="Label" required="false"/>
        </field>
        <field name="Correlator" separator="/">
            <field-locator id="MailBox" locator="AFILE_MAILBOX_PATH" locator-type="Label" required="false"/>
            <field-locator id="FileName" locator="AFILE_FILE_NAME" locator-type="Label" required="false"/>
        </field>
        <field name="Correlator" formattingPattern="CorrelatorsSet_{0}">
            <field-locator id="DocumentId" locator="AFILE_DOCUMENT_ID" locator-type="Label"/>
        </field>
        <field name="Correlator" formattingPattern="Document_{0}">
            <field-locator id="DocumentId" locator="AFILE_DOCUMENT_ID" locator-type="Label"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="AF_ModifyTs" locator="AFILE_MODIFYTS" locator-type="Label" transparent="true"/>
    </parser>

    <parser name="B2BiFGEventAttributesXMLParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityXmlParser">
        <field name="FG_E_Attr_${FieldNameLoc}" locator="/attributes/attr[*]/EVENTATTR_VALUE" locator-type="Label">
            <field-locator id="FieldNameLoc" locator="/attributes/attr[*]/EVENTATTR_NAME" locator-type="Label">
                <field-transform lang="groovy" name="AttrNameTransform"><![CDATA[
                    Strings.replace($fieldValue, "@", "_");
                ]]></field-transform>
            </field-locator>
        </field>
    </parser>

    <parser name="B2BiFGEventsResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="FGEvent_{0}">
            <field-locator id="EventKey" locator="EVENT_EVENT_KEY" locator-type="Label"/>
        </field>
        <field name="EventName" locator="EVENT_ENTITY_TYPE" locator-type="Label"/>
        <field name="StartTime" locator="AF_CREATE_TS" locator-type="Label"/>
        <field name="EndTime" locator="EVENT_TIME" locator-type="Label" datatype="Number" units="Milliseconds" timezone="GMT-04:00"/>

        <field name="EntityKey" locator="EVENT_ENTITY_KEY" locator-type="Label"/>
        <field name="DataFlowId" locator="EVENT_DATA_FLOW_ID" locator-type="Label"/>
        <field name="Counter" locator="EVENT_COUNTER" locator-type="Label" datatype="Number" format="long"/>
        <field name="EventCode" locator="EVENT_EVENT_CODE" locator-type="Label"/>
        <field name="LockId" locator="EVENT_LOCKID" locator-type="Label" datatype="Number" format="integer"/>
        <field name="CreateTs" locator="EVENT_CREATETS" locator-type="Label"/>
        <field name="ModifyTs" locator="EVENT_MODIFYTS" locator-type="Label"/>
        <field name="CreateUserId" locator="EVENT_CREATEUSERID" locator-type="Label"/>
        <field name="ModifyUserId" locator="EVENT_MODIFYUSERID" locator-type="Label"/>
        <field name="CreateProgId" locator="EVENT_CREATEPROGID" locator-type="Label"/>
        <field name="ModifyProgId" locator="EVENT_MODIFYPROGID" locator-type="Label"/>

        <field name="EventCodeDescr" locator="EventCode" locator-type="Activity">
            <field-map-ref resource="EVENT_CODE_MAPPINGS.EventCode"/>
        </field>
        <field name="CompCode" locator="EventCode" locator-type="Activity">
            <field-map-ref resource="EVENT_CODE_MAPPINGS.EventCompCode"/>
        </field>
        <field name="Severity" locator="EventCode" locator-type="Activity">
            <field-map-ref resource="EVENT_CODE_MAPPINGS.EventSeverity"/>
        </field>
        <field name="EventType" value="">    <!-- TODO: maybe add more types over mapping like START, UPDATE etc -->
            <field-transform lang="groovy" name="DiffTransform"><![CDATA[
                ${EventCode} == "FG_0425"
                   ? "RECEIVE"
                   : ${EventCode} == "FG_0701"
                       ? "SEND"
                       : "EVENT"
            ]]></field-transform>
        </field>

        <!-- FG_EVENTATTR table columns from XML -->
        <embedded-activity name="FG_Event_Attrs" locator="EVT_ATTRS" locator-type="Label">
            <parser-ref name="B2BiFGEventAttributesXMLParser" aggregation="Merge"/>
        </embedded-activity>
        <field name="Owner" value="">
            <field-transform lang="groovy" name="DiffTransform"><![CDATA[
                ${EventName} == "ARRIVED_FILE"
                   ? "Consumer"
                   : ${EventName} == "DELIVERY"
                       ? "Producer"
                       : "GW"
            ]]></field-transform>
        </field>
        <field name="ApplLookUp" locator="FG_E_Attr_RoutingChannelTemplateName" locator-type="Activity"/>
        <field name="CacheApplLookUp" locator="CachedApplName" locator-type="Cache" transparent="true"/>
        <field name="ApplName" separator=":">
            <field-locator id="AppLookUp" locator="ApplLookUp" locator-type="Activity" required="false">
                <field-transform lang="groovy" name="AppLookUpTransform" phase="raw"><![CDATA[
                    StringUtils.isEmpty($fieldValue) ? ${CacheApplLookUp} : $fieldValue
                ]]></field-transform>
            </field-locator>
            <field-locator id="Owner" locator="Owner" locator-type="Activity" required="false"/>
        </field>
        <field name="ResourceNameTemp" separator="/" transparent="true" datatype="String">
            <field-locator id="ProducerMailboxPath" locator="FG_E_Attr_ProducerMailboxPath" locator-type="Activity" required="false"/>
            <field-locator id="ProducerFilename" locator="FG_E_Attr_ProducerFilename" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerMailboxPath" locator="FG_E_Attr_ConsumerMailboxPath" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerFilename" locator="FG_E_Attr_ConsumerFilename" locator-type="Activity" required="false"/>
        </field>
        <field name="ResourceName" locator="ResourceNameTemp" locator-type="Activity" formattingPattern="FILE={0}"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator">
            <!-- XML stream configuration (minimized)-->
            <field-locator id="AsyncXrefId" locator="FG_E_Attr_AsyncTransferId" locator-type="Activity" required="false"/>
            <field-locator id="ProducerDocumentId" locator="FG_E_Attr_ProducerDocumentId" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerFilename" locator="FG_E_Attr_ConsumerFilename" locator-type="Activity" required="false"/>
            <field-locator id="ProducerPayload" locator="FG_E_Attr_ProducerPayload" locator-type="Activity" required="false"/>
            <field-locator id="ProducerPayloadDocumentId" locator="FG_E_Attr_ProducerPayloadDocumentId" locator-type="Activity"
                           required="false"/>
            <field-locator id="ConsumerDocumentId" locator="FG_E_Attr_ConsumerDocumentId" locator-type="Activity" required="false"/>
            <field-locator id="DataFlowId" locator="DataFlowId" locator-type="Activity" required="false"/>
        </field>
        <field name="Correlator" formattingPattern="AFile_{0}">
            <field-locator id="AFileKey" locator="EVENT_ARRIVED_FILE_KEY" locator-type="Label"/>
        </field>
        <field name="Correlator" separator=":">
            <field-locator id="DataFlowId" locator="DataFlowId" locator-type="Activity"/>
            <field-locator id="ProducerFilename" locator="FG_E_Attr_ProducerFilename" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerFilename" locator="FG_E_Attr_ConsumerFilename" locator-type="Activity" required="false"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="E_ModifyTs" locator="EVENT_MODIFYTS" locator-type="Label" transparent="true"/>

        <!-- Filter out events having no DATA_FLOW_ID or equal to 0 -->
        <filter name="EventDFFilter">
            <expression handle="exclude" lang="groovy"><![CDATA[
               ${DataFlowId} == null || ${DataFlowId} == 0
            ]]></expression>
        </filter>
    </parser>

    <parser name="B2BiFGEventsApplResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="FGEvent_{0}">
            <field-locator id="EventKey" locator="EVENT_EVENT_KEY" locator-type="Label"/>
        </field>
        <field name="EventName" locator="EVENT_ENTITY_TYPE" locator-type="Label"/>
        <field name="StartTime" locator="AF_CREATE_TS" locator-type="Label"/>
        <field name="EndTime" locator="EVENT_TIME" locator-type="Label" datatype="Number" units="Milliseconds" timezone="GMT-04:00"/>

        <field name="EntityKey" locator="EVENT_ENTITY_KEY" locator-type="Label"/>
        <field name="DataFlowId" locator="EVENT_DATA_FLOW_ID" locator-type="Label"/>
        <field name="Counter" locator="EVENT_COUNTER" locator-type="Label" datatype="Number" format="long"/>
        <field name="EventCode" locator="EVENT_EVENT_CODE" locator-type="Label"/>
        <field name="LockId" locator="EVENT_LOCKID" locator-type="Label" datatype="Number" format="integer"/>
        <field name="CreateTs" locator="EVENT_CREATETS" locator-type="Label"/>
        <field name="ModifyTs" locator="EVENT_MODIFYTS" locator-type="Label"/>
        <field name="CreateUserId" locator="EVENT_CREATEUSERID" locator-type="Label"/>
        <field name="ModifyUserId" locator="EVENT_MODIFYUSERID" locator-type="Label"/>
        <field name="CreateProgId" locator="EVENT_CREATEPROGID" locator-type="Label"/>
        <field name="ModifyProgId" locator="EVENT_MODIFYPROGID" locator-type="Label"/>

        <field name="EventCodeDescr" locator="EventCode" locator-type="Activity">
            <field-map-ref resource="EVENT_CODE_MAPPINGS.EventCode"/>
        </field>
        <field name="CompCode" locator="EventCode" locator-type="Activity">
            <field-map-ref resource="EVENT_CODE_MAPPINGS.EventCompCode"/>
        </field>
        <field name="Severity" locator="EventCode" locator-type="Activity">
            <field-map-ref resource="EVENT_CODE_MAPPINGS.EventSeverity"/>
        </field>    
        <field name="EventType" value="">    <!-- TODO: maybe add more types over mapping like START, UPDATE etc -->
            <field-transform lang="groovy" name="DiffTransform"><![CDATA[
                ${EventCode} == "FG_0425"
                   ? "RECEIVE"
                   : ${EventCode} == "FG_0701"
                       ? "SEND"
                       : "EVENT"
            ]]></field-transform>
        </field>

        <!-- FG_EVENTATTR table columns from XML -->
        <embedded-activity name="FG_Event_Attrs" locator="EVT_ATTRS" locator-type="Label">
            <parser-ref name="B2BiFGEventAttributesXMLParser" aggregation="Merge"/>
        </embedded-activity>
        <field name="Owner" value="">
            <field-transform lang="groovy" name="DiffTransform"><![CDATA[
                ${EventName} == "ARRIVED_FILE"
                   ? "Consumer"
                   : ${EventName} == "DELIVERY"
                       ? "Producer"
                       : "GW"
            ]]></field-transform>
        </field>
        <field name="ApplLookUp" locator="APPL_NAME" locator-type="Label"/>
        <field name="CacheApplLookUp" locator="CachedApplName" locator-type="Cache" transparent="true"/>
        <field name="ApplName" separator=":">
            <field-locator id="AppLookUp" locator="ApplLookUp" locator-type="Activity" required="false">
                <field-transform lang="groovy" name="AppLookUpTransform" phase="raw"><![CDATA[
                    StringUtils.isEmpty($fieldValue) ? ${CacheApplLookUp} : $fieldValue
                ]]></field-transform>
            </field-locator>
            <field-locator id="Owner" locator="Owner" locator-type="Activity" required="false"/>
        </field>
        <field name="ResourceNameTemp" separator="/" transparent="true" datatype="String">
            <field-locator id="ProducerMailboxPath" locator="FG_E_Attr_ProducerMailboxPath" locator-type="Activity" required="false"/>
            <field-locator id="ProducerFilename" locator="FG_E_Attr_ProducerFilename" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerMailboxPath" locator="FG_E_Attr_ConsumerMailboxPath" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerFilename" locator="FG_E_Attr_ConsumerFilename" locator-type="Activity" required="false"/>
        </field>
        <field name="ResourceName" locator="ResourceNameTemp" locator-type="Activity" formattingPattern="FILE={0}"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator">
            <!-- XML stream configuration (minimized)-->
            <field-locator id="AsyncXrefId" locator="FG_E_Attr_AsyncTransferId" locator-type="Activity" required="false"/>
            <field-locator id="ProducerDocumentId" locator="FG_E_Attr_ProducerDocumentId" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerFilename" locator="FG_E_Attr_ConsumerFilename" locator-type="Activity" required="false"/>
            <field-locator id="ProducerPayload" locator="FG_E_Attr_ProducerPayload" locator-type="Activity" required="false"/>
            <field-locator id="ProducerPayloadDocumentId" locator="FG_E_Attr_ProducerPayloadDocumentId" locator-type="Activity"
                           required="false"/>
            <field-locator id="ConsumerDocumentId" locator="FG_E_Attr_ConsumerDocumentId" locator-type="Activity" required="false"/>
            <field-locator id="DataFlowId" locator="DataFlowId" locator-type="Activity" required="false"/>
        </field>
        <field name="Correlator" formattingPattern="AFile_{0}">
            <field-locator id="AFileKey" locator="EVENT_ARRIVED_FILE_KEY" locator-type="Label"/>
        </field>
        <field name="Correlator" separator=":">
            <field-locator id="DataFlowId" locator="DataFlowId" locator-type="Activity"/>
            <field-locator id="ProducerFilename" locator="FG_E_Attr_ProducerFilename" locator-type="Activity" required="false"/>
            <field-locator id="ConsumerFilename" locator="FG_E_Attr_ConsumerFilename" locator-type="Activity" required="false"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="E_App_ModifyTs" locator="REF_EVENT_MODIFYTS" locator-type="Label" transparent="true"/>

        <!-- Filter out events having: -->
        <!--        * no DATA_FLOW_ID or equal to 0 -->
        <!--        * APPL_NAME undefined -->
        <filter name="EventDFFilter">
            <expression handle="exclude" lang="groovy"><![CDATA[
               ${DataFlowId} == null || ${DataFlowId} == 0 || ${ApplLookUp} == null
            ]]></expression>
        </filter>
    </parser>

    <parser name="B2BiRoutesResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="Route_{0}">
            <field-locator id="RouteKey" locator="ROUTE_KEY" locator-type="Label"/>
        </field>
        <field name="EventType" value="EVENT"/>
        <field name="EventName" separator=".">
            <field-locator id="DataFlowId" locator="ROUTE_DATA_FLOW_ID" locator-type="Label"/>
            <field-locator id="ConsOrgKey" locator="ROUTE_CONS_ORG_KEY" locator-type="Label"/>
            <field-locator id="State" locator="ROUTE_STATE" locator-type="Label"/>
        </field>
        <field name="StartTime" locator="ROUTE_START_TIME" locator-type="Label"/>
        <field name="EndTime" locator="ROUTE_COMPLETE_TIME" locator-type="Label">
            <field-transform name="RouteEndTimeTransform" lang="groovy">
                $fieldValue == null ? ${StartTime} : $fieldValue
            </field-transform>
        </field>

        <field name="DataFlowId" locator="ROUTE_DATA_FLOW_ID" locator-type="Label"/>
        <field name="RoutchanKey" locator="ROUTE_ROUTCHAN_KEY" locator-type="Label"/>
        <field name="ConsOrgKey" locator="ROUTE_CONS_ORG_KEY" locator-type="Label"/>
        <field name="ConsOrgName" locator="ROUTE_CONS_ORG_NAME" locator-type="Label"/>
        <field name="PFstructKey" locator="ROUTE_P_FSTRUCT_KEY" locator-type="Label"/>
        <field name="State" locator="ROUTE_STATE" locator-type="Label"/>
        <field name="DelivsRemain" locator="ROUTE_DELIVS_REMAIN" locator-type="Label" datatype="Number" format="integer"/>
        <field name="LockId" locator="ROUTE_LOCKID" locator-type="Label" datatype="Number" format="integer"/>
        <field name="CreateTs" locator="ROUTE_CREATETS" locator-type="Label"/>
        <field name="ModifyTs" locator="ROUTE_MODIFYTS" locator-type="Label"/>
        <field name="CreateUserId" locator="ROUTE_CREATEUSERID" locator-type="Label"/>
        <field name="ModifyUserId" locator="ROUTE_MODIFYUSERID" locator-type="Label"/>
        <field name="CreateProgId" locator="ROUTE_CREATEPROGID" locator-type="Label"/>
        <field name="ModifyProgId" locator="ROUTE_MODIFYPROGID" locator-type="Label"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator">
            <field-locator id="DataFlowId" locator="ROUTE_DATA_FLOW_ID" locator-type="Label" required="false"/>
        </field>
        <field name="Correlator" formattingPattern="AFile_{0}">
            <field-locator id="AFileKey" locator="ROUTE_AFILE_KEY" locator-type="Label"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="R_ModifyTs" locator="ROUTE_MODIFYTS" locator-type="Label" transparent="true"/>

        <!-- Filter out routes having no channel key defined -->
        <!--filter name="EventDFFilter">
            <expression handle="exclude" lang="groovy"><![CDATA[
               ${RoutchanKey} == null
            ]]></expression>
        </filter-->
    </parser>

    <parser name="B2BiDeliveriesResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="Delivery_{0}">
            <field-locator id="DeliveryKey" locator="DELIVERY_KEY" locator-type="Label"/>
        </field>
        <field name="EventType" value="EVENT"/>
        <field name="EventName" separator=".">
            <field-locator id="DataFlowId" locator="DELIVERY_DATA_FLOW_ID" locator-type="Label"/>
            <field-locator id="Mailbox" locator="DELIVERY_MAILBOX_PATH" locator-type="Label"/>
            <field-locator id="FileName" locator="DELIVERY_FILENAME" locator-type="Label"/>
        </field>
        <field name="StartTime" locator="DELIVERY_CREATETS" locator-type="Label"/>
        <field name="EndTime" locator="DELIVERY_MODIFYTS" locator-type="Label"/>

        <field name="DataFlowId" locator="DELIVERY_DATA_FLOW_ID" locator-type="Label"/>
        <field name="State" locator="DELIVERY_STATE" locator-type="Label"/>
        <field name="DelivChanKey" locator="DELIVERY_DELIVCHAN_KEY" locator-type="Label"/>
        <field name="ConsumerDocId" locator="DELIVERY_CONSUMER_DOCID" locator-type="Label"/>
        <field name="ContentType" locator="DELIVERY_CONTENT_TYPE" locator-type="Label"/>
        <field name="FileName" locator="DELIVERY_FILENAME" locator-type="Label"/>
        <field name="ConsDocType" locator="DELIVERY_CONSDOC_TYPE" locator-type="Label"/>
        <field name="MailBoxPath" locator="DELIVERY_MAILBOX_PATH" locator-type="Label"/>
        <field name="LateCreateMbx" locator="DELIVERY_LATE_CREATE_MBX" locator-type="Label"/>
        <field name="ConsumerMsgId" locator="DELIVERY_CONSUMER_MSGID" locator-type="Label" datatype="Number" format="long"/>
        <field name="AsyncXrefId" locator="DELIVERY_ASYNC_XFER_ID" locator-type="Label"/>
        <field name="LockId" locator="DELIVERY_LOCKID" locator-type="Label" datatype="Number" format="integer"/>
        <field name="CreateUserId" locator="DELIVERY_CREATEUSERID" locator-type="Label"/>
        <field name="ModifyUserId" locator="DELIVERY_MODIFYUSERID" locator-type="Label"/>
        <field name="CreateProgId" locator="DELIVERY_CREATEPROGID" locator-type="Label"/>
        <field name="ModifyProgId" locator="DELIVERY_MODIFYPROGID" locator-type="Label"/>
        <field name="DistConsumerMsgId" locator="DELIVERY_DIST_CONSUMER_MSGID" locator-type="Label"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator">
            <field-locator id="DataFlowId" locator="DELIVERY_DATA_FLOW_ID" locator-type="Label" required="false"/>
            <field-locator id="AsyncXrefId" locator="DELIVERY_ASYNC_XFER_ID" locator-type="Label" required="false"/>
        </field>
        <field name="Correlator" formattingPattern="Route_{0}">
            <field-locator id="RouteKey" locator="DELIVERY_ROUTE_KEY" locator-type="Label"/>
        </field>
        <field name="Correlator" formattingPattern="CorrelatorsSet_{0}">
            <field-locator id="DocumentId" locator="DELIVERY_CONSUMER_DOCID" locator-type="Label"/>
        </field>
        <field name="Correlator" formattingPattern="Document_{0}">
            <field-locator id="DocumentId" locator="DELIVERY_CONSUMER_DOCID" locator-type="Label"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="D_ModifyTs" locator="DELIVERY_MODIFYTS" locator-type="Label" transparent="true"/>

        <!-- Filter out deliveries having no filename defined -->
        <!--filter name="EventDFFilter">
            <expression handle="exclude" lang="groovy"><![CDATA[
               ${FileName} == null
            ]]></expression>
        </filter-->
    </parser>

    <parser name="B2BiCorrelationSetResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="Correlation_{0}">
            <field-locator id="CorrelId" locator="CORRELATION_ID" locator-type="Label"/>
        </field>
        <field name="EventType" value="EVENT"/>
        <field name="EventName" separator=":">
            <field-locator id="Type" locator="CORRELATION_TYPE" locator-type="Label"/>
            <field-locator id="Name" locator="CORRELATION_NAME" locator-type="Label"/>
        </field>
        <field name="StartTime" locator="CORRELATION_REC_TIME" locator-type="Label"/>
        <field name="EndTime" locator="CORRELATION_REC_TIME" locator-type="Label"/>

        <field name="Name" locator="CORRELATION_NAME" locator-type="Label"/>
        <field name="Value" locator="CORRELATION_VALUE" locator-type="Label"/>
        <field name="Type" locator="CORRELATION_TYPE" locator-type="Label"/>
        <field name="ObjectId" locator="CORRELATION_OBJECT_ID" locator-type="Label"/>
        <field name="ArchiveFlag" locator="CORRELATION_ARCHIVE_FLAG" locator-type="Label" datatype="Number" format="int"/>
        <field name="ArchiveDate" locator="CORRELATION_ARCHIVE_DATE" locator-type="Label"/>
        <field name="WorkFlowId" locator="CORRELATION_WF_ID" locator-type="Label" datatype="Number" format="long"/>
        <field name="KeyId" locator="CORRELATION_KEY_ID" locator-type="Label" datatype="Number" format="long"/>
        <field name="ValueUpperCase" locator="CORRELATION_VALUE_UPPER" locator-type="Label"/>
        <field name="KeyName" locator="CORR_KEY_NAME" locator-type="Label"/>
        <field name="KeyScope" locator="CORR_KEY_SCOPE" locator-type="Label"/>
        <field name="KeyType" locator="CORR_KEY_TYPE" locator-type="Label"/>
        <field name="KeyLabel" locator="CORR_KEY_LABEL" locator-type="Label"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator" formattingPattern="CorrelatorsSet_{0}">
            <field-locator id="ObjectId" locator="CORRELATION_OBJECT_ID" locator-type="Label"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="CS_RecTime" locator="CORRELATION_REC_TIME" locator-type="Label" transparent="true"/>

        <!-- TODO: filtering if needed -->
    </parser>

    <parser name="B2BiWorkflowContextResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="Workflow_{0}">
            <field-locator id="WorkflowWFCId" locator="WORKFLOW_WFC_ID" locator-type="Label"/>
        </field>
        <field name="EventType" value="EVENT"/>
        <field name="EventName" separator=":">
            <field-locator id="ServiceName" locator="WORKFLOW_SERVICE_NAME" locator-type="Label"/>
        </field>
        <field name="StartTime" locator="WORKFLOW_START_TIME" locator-type="Label"/>
        <field name="EndTime" locator="WORKFLOW_END_TIME" locator-type="Label"/>

        <field name="WFDId" locator="WORKFLOW_WFD_ID" locator-type="Label" datatype="Number" format="long"/>
        <field name="WFDVersion" locator="WORKFLOW_WFD_VERSION" locator-type="Label" datatype="Number" format="long"/>
        <field name="WorkflowId" locator="WORKFLOW_ID" locator-type="Label" datatype="Number" format="long"/>
        <field name="ActivityId" locator="WORKFLOW_ACTIVITYINFO_ID" locator-type="Label" datatype="Number" format="int"/>
        <field name="NextActivityId" locator="WORKFLOW_NEXT_AI_ID" locator-type="Label" datatype="Number" format="int"/>
        <field name="OriginalWFCId" locator="WORKFLOW_ORIG_WFC_ID" locator-type="Label"/>
        <field name="PreviousWFCId" locator="WORKFLOW_PREV_WFC_ID" locator-type="Label"/>
        <field name="ParentWFDId" locator="WORKFLOW_PARENT_WFD_ID" locator-type="Label" datatype="Number" format="int"/>
        <field name="ParentWFDVersion" locator="WORKFLOW_PARENT_WFD_VERSION" locator-type="Label" datatype="Number" format="int"/>
        <field name="BranchId" locator="WORKFLOW_BRANCH_ID" locator-type="Label"/>
        <field name="StepId" locator="WORKFLOW_STEP_ID" locator-type="Label" datatype="Number" format="int"/>
        <field name="ServiceName" locator="WORKFLOW_SERVICE_NAME" locator-type="Label"/>
        <field name="DocId" locator="WORKFLOW_DOC_ID" locator-type="Label"/>
        <field name="BasicStatus" locator="WORKFLOW_BASIC_STATUS" locator-type="Label" datatype="Number" format="int"/>
        <field name="ADVStatus" locator="WORKFLOW_ADV_STATUS" locator-type="Label"/>
        <field name="StatusRPT" locator="WORKFLOW_STATUS_RPT" locator-type="Label"/>
        <field name="Content" locator="WORKFLOW_CONTENT" locator-type="Label"/>
        <field name="WFEStatus" locator="WORKFLOW_WFE_STATUS" locator-type="Label" datatype="Number" format="int"/>
        <field name="WFEStatusRPT" locator="WORKFLOW_WFE_STATUS_RPT" locator-type="Label"/>
        <field name="SVCParamVersion" locator="WORKFLOW_SVC_PARM_VER" locator-type="Label" datatype="Number" format="long"/>
        <field name="Lifespan" locator="WORKFLOW_LIFE_SPAN" locator-type="Label"/>
        <field name="PersistenceLevel" locator="WORKFLOW_PERSISTENCE_LEVEL" locator-type="Label" datatype="Number" format="int"/>
        <field name="ArchiveFlag" locator="WORKFLOW_ARCHIVE_FLAG" locator-type="Label" datatype="Number" format="int"/>
        <field name="ArchiveDate" locator="WORKFLOW_ARCHIVE_DATE" locator-type="Label"/>
        <field name="EnterQ" locator="WORKFLOW_ENTERQ" locator-type="Label"/>
        <field name="ExitQ" locator="WORKFLOW_EXITQ" locator-type="Label"/>
        <field name="Deadline" locator="WORKFLOW_DEADLINE" locator-type="Label"/>
        <field name="ContractId" locator="WORKFLOW_CONTRACT_ID" locator-type="Label"/>
        <field name="NodeExcluded" locator="WORKFLOW_NODEEXECUTED" locator-type="Label"/>
        <field name="EventLevel" locator="WORKFLOW_EVENT_LEVEL" locator-type="Label" datatype="Number" format="int"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator" formattingPattern="CorrelatorsSet_{0}">
            <field-locator id="DocumentId" locator="WORKFLOW_DOC_ID" locator-type="Label"/>
        </field>
        <field name="Correlator" formattingPattern="Document_{0}">
            <field-locator id="DocumentId" locator="WORKFLOW_DOC_ID" locator-type="Label"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="WC_StartTime" locator="WORKFLOW_START_TIME" locator-type="Label" transparent="true"/>

        <!-- TODO: filtering if needed -->
    </parser>

    <parser name="B2BiTransferIdsXMLParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityXmlParser">
        <!-- Correlator to relate FG flow with MFT flow -->
        <field name="Correlator">
            <field-locator id="XferId" locator="/xfers/xfer[*]/XFER_ID" locator-type="Label">
                <field-transform lang="groovy" name="XFerIdTransform"><![CDATA[
                    Strings.extractToken($fieldValue, ":", 2);
                ]]></field-transform>
            </field-locator>
        </field>
    </parser>

    <parser name="B2BiDocumentsResultSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityJDBCResultSetParser">
        <field name="Guid" formattingPattern="Document_{0}">
            <field-locator id="WorkflowDocId" locator="DOCUMENT_ID" locator-type="Label"/>
        </field>
        <field name="EventType" value="EVENT"/>
        <field name="EventName" separator=":">
            <field-locator id="DocumentName" locator="DOCUMENT_DOC_NAME" locator-type="Label"/>
            <field-locator id="DataFlowId" locator="DATA_FLOW_DATA_FLOW_ID" locator-type="Label"/>
        </field>
        <field name="StartTime" locator="DOCUMENT_CREATE_TIME" locator-type="Label"/>
        <field name="EndTime" locator="DOCUMENT_MODIFYTS" locator-type="Label"/>

        <field name="DocumentId" locator="DOCUMENT_ID" locator-type="Label"/>
        <field name="Subject" locator="DOCUMENT_SUBJECT" locator-type="Label"/>
        <field name="ContentType" locator="DOCUMENT_CONT_TYPE" locator-type="Label"/>
        <field name="ContentSubtype" locator="DOCUMENT_CONT_SUBTYPE" locator-type="Label"/>
        <field name="PrevDocId" locator="DOCUMENT_PREV_DOC_ID" locator-type="Label"/>
        <!--<field name="BodyName" locator="DOCUMENT_BODY_NAME" locator-type="Label"/>-->
        <!--<field name="Body" locator="DOCUMENT_BODY" locator-type="Label"/>-->
        <field name="CharEncoding" locator="DOCUMENT_CHAR_ENCODING" locator-type="Label"/>
        <field name="DocumentName" locator="DOCUMENT_DOC_NAME" locator-type="Label"/>
        <field name="WFId" locator="DOCUMENT_WORKFLOW_ID" locator-type="Label" datatype="Number" format="int"/>
        <field name="PurgeAfter" locator="DOCUMENT_PURGE_AFTER" locator-type="Label" datatype="Timestamp"/>
        <field name="ArchiveFlag" locator="DOCUMENT_ARCHIVE_FLAG" locator-type="Label" datatype="Number" format="int"/>
        <field name="ArchiveDate" locator="DOCUMENT_ARCHIVE_DATE" locator-type="Label" datatype="Timestamp"/>
        <field name="DocumentSize" locator="DOCUMENT_DOCUMENT_SIZE" locator-type="Label" datatype="Number" format="long"/>
        <field name="StorageType" locator="DOCUMENT_STORAGE_TYPE" locator-type="Label" datatype="Number" format="int"/>
        <field name="EncodingAlg" locator="DOCUMENT_ENC_ALG" locator-type="Label"/>
        <field name="EncodingIv" locator="DOCUMENT_ENC_IV" locator-type="Label"/>
        <field name="EncodingKey" locator="DOCUMENT_ENC_KEY" locator-type="Label"/>
        <field name="DataFlowId" locator="DATA_FLOW_DATA_FLOW_ID" locator-type="Label" datatype="Number" format="int"/>
        <field name="DataFlowState" locator="DATA_FLOW_STATE" locator-type="Label"/>
        <field name="DataFlowCreateTime" locator="DATA_FLOW_CREATE_TIME" locator-type="Label" datatype="Timestamp"/>
        <field name="DataFlowDocName" locator="DATA_FLOW_ROOT_DOC_NAME" locator-type="Label"/>
        <field name="DataFlowDocSize" locator="DATA_FLOW_ROOT_DOC_SIZE" locator-type="Label" datatype="Number" format="int"/>

        <!-- Correlators to build flow context -->
        <field name="Correlator">
            <field-locator id="DataFlowId" locator="DATA_FLOW_DATA_FLOW_ID" locator-type="Label" required="false"/>
        </field>
        <field name="Correlator" formattingPattern="File_{0}_{1}">
            <field-locator id="DocumentName" locator="DOCUMENT_DOC_NAME" locator-type="Label"/>
            <field-locator id="DocumentSize" locator="DOCUMENT_DOCUMENT_SIZE" locator-type="Label" datatype="Number" format="long"/>
        </field>
        <field name="Correlator" formattingPattern="CorrelatorsSet_{0}">
            <field-locator id="DocumentId" locator="DOCUMENT_ID" locator-type="Label"/>
        </field>

        <!-- Store latest value to cache -->
        <field name="Doc_ModifyTs" locator="DOCUMENT_MODIFYTS" locator-type="Label" transparent="true"/>

        <!-- ACT_XFER table columns from XML -->
        <embedded-activity name="TransferIds" locator="XFER_XFER_IDS" locator-type="Label">
            <parser-ref name="B2BiTransferIdsXMLParser" aggregation="Merge"/>
        </embedded-activity>

        <!-- TODO: filtering if needed -->
    </parser>

    <cache>
        <property name="MaxSize" value="2000"/>
        <property name="ExpireDuration" value="43200"/>

        <property name="Persisted" value="true"/>
        <property name="FileName" value="./cache/b2biCache.xml"/>
        <property name="PersistingPeriod" value="300"/>

        <entry id="LastAFileRecordMDate">
            <key>LastAFileRecordMDate</key>
            <value>${AF_ModifyTs}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="LastEventRecordMDate">
            <key>LastEventRecordMDate</key>
            <value>${E_ModifyTs}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="LastEventApplRecordMDate">
            <key>LastEventApplRecordMDate</key>
            <value>${E_App_ModifyTs}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="LastRouteRecordMDate">
            <key>LastRouteRecordMDate</key>
            <value>${R_ModifyTs}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="LastDeliveryRecordMDate">
            <key>LastDeliveryRecordMDate</key>
            <value>${D_ModifyTs}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="LastCorrelationSetRecordMDate">
            <key>LastCorrelationSetRecordMDate</key>
            <value>${CS_RecTime}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="LastWorkflowContextRecordMDate">
            <key>LastWorkflowContextRecordMDate</key>
            <value>${WC_StartTime}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="LastDocumentsRecordMDate">
            <key>LastDocumentsRecordMDate</key>
            <value>${Doc_ModifyTs}</value>
            <default>1970-01-01 00:00:00.000</default>
        </entry>
        <entry id="CachedApplName">
            <key>${DataFlowId}</key>
            <value>${ApplLookUp}</value>
        </entry>
    </cache>

</tnt-data-source>
