<?xml version="1.0" encoding="utf-8"?>
<tnt-data-source
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/Nastel/tnt4j-streams/master/config/tnt-data-source.xsd">

    <java-object name="WmqStreamOutput" class="com.jkoolcloud.tnt4j.streams.outputs.JKCloudActivityOutput">
        <property name="TurnOutActivityChildren" value="true"/>
    </java-object>

    <parser name="TransferSetParser" class="com.jkoolcloud.tnt4j.streams.parsers.ActivityXmlParser">
        <field name="EventType" locator="name(//*[1])" locator-type="Label">
            <field-map source="destination" target="SEND"/>
            <field-map source="source" target="RECEIVE"/>
            <field-map source="" target="NOOP"/>
        </field>
        <field name="EventName" locator="name(//*[1])" locator-type="Label">
            <field-map source="destination" target="process_destination"/>
            <field-map source="source" target="process_source"/>
            <field-map source="" target="N/A"/>
        </field>
        <field name="ResourceName" separator="=">
            <!-- resource type-->
            <field-locator locator="name(//*/*)" locator-type="Label"/>

            <!-- resource names-->
            <field-locator locator="ts:getFileName(source/file)" locator-type="Label" required="false"/>
            <field-locator locator="ts:getFileName(destination/file)" locator-type="Label" required="false"/>
            <field-locator locator="/transaction/sourceAgent/@agent" locator-type="Label" required="false"/>
            <field-locator locator="source/queue" locator-type="Label" required="false"/>
            <field-locator locator="destination/queue" locator-type="Label" required="false"/>
            <field-locator locator="/transaction/destinationAgent/@agent" locator-type="Label" required="false"/>
        </field>

        <field name="Size" locator="//*/file/@size" locator-type="Label" required="false"/>
        <field name="LastModified" locator="//*/file/@last-modified" locator-type="Label" required="false"/>
        <field name="Checksum" locator="//*/checksum" locator-type="Label" required="false"/>
        <field name="ChecksumMethod" locator="//*/checksum/@method" locator-type="Label" required="false"/>
    </parser>

    <parser name="ProgressEventParser" class="com.jkoolcloud.tnt4j.streams.parsers.MessageActivityXmlParser">
        <property name="SignatureDelim" value="#!#"/>
        <property name="RequireDefault" value="false"/>

        <field name="EventType" value="NOOP"/>

        <field name="Filter" locator="/transaction/action/text()[. = 'progress']" locator-type="Label" required="true"/>
        <field name="UserName" locator="/transaction/originator/userID" locator-type="Label"/>
        <field name="Location" locator="/transaction/originator/hostName" locator-type="Label"/>
        <field name="ApplName" separator=":">
            <field-locator value="JOB"/>
            <field-locator locator="/transaction/job/name" locator-type="Label" required="false"/>
        </field>
        <field name="ServerName" locator="/transaction/originator/hostName" locator-type="Label"/>
        <field name="ServerOs" locator="/transaction/sourceAgent/systemInfo/@name" locator-type="Label"/>
        <field name="StartTime" locator="/transaction/action/@time" locator-type="Label" datatype="DateTime"
               format="yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" timezone="GMT"/>
        <field name="ReasonCode" separator="">
            <field-locator locator="/transaction/transferSet/item/status/@resultCode" locator-type="Label" datatype="Number"/>
        </field>
        <field name="CompCode" locator="/transaction/transferSet/item/status/@resultCode" locator-type="Label">
            <field-map source="0" target="SUCCESS"/>
            <field-map source="40" target="WARNING"/>
            <field-map source="" target="ERROR"/>
        </field>
        <field name="Correlator" locator="/transaction/@ID" locator-type="Label" datatype="String" format="string"/>
        <field name="Exception" separator="">
            <field-locator locator="/transaction/transferSet/item/status/supplement" locator-type="Label" required="false"/>
        </field>
        <field name="ResourceMgr" locator="/transaction/sourceAgent/@QMgr" locator-type="Label"/>
        <field name="ResMgrType" value="MESSAGING_SERVER"/>

        <field name="MFT_SRC_FILE_NAME" locator="ts:getFileName(/transaction/transferSet/item/source/file)" locator-type="Label"/>
        <field name="MFT_DST_FILE_NAME" locator="ts:getFileName(/transaction/transferSet/item/destination/file)" locator-type="Label"/>
        <field name="MFT_SRC_QUEUE_NAME" locator="ts:getFileName(/transaction/transferSet/item/source/queue)" locator-type="Label"/>
        <field name="MFT_DST_QUEUE_NAME" locator="ts:getFileName(transaction/transferSet/item/destination/queue)" locator-type="Label"/>

        <field name="MFT_SOURCE_AGNT" locator="/transaction/sourceAgent/@agent" locator-type="Label" required="false"/>
        <field name="MFT_DEST_AGNT" locator="/transaction/destinationAgent/@agent" locator-type="Label" required="false"/>
        <field name="MFT_TRF_FILE_SIZE" locator="/transaction/transferSet/@bytesSent" locator-type="Label" required="false"/>
        <embedded-activity name="TRANSFERSET" locator="/transaction/transferSet/item/*" locator-type="Label">
            <parser-ref name="TransferSetParser" aggregation="Join"/>
        </embedded-activity>
    </parser>

    <parser name="StartedEventParser" class="com.jkoolcloud.tnt4j.streams.parsers.MessageActivityXmlParser">
        <property name="SignatureDelim" value="#!#"/>
        <property name="RequireDefault" value="true"/>

        <field name="EventType" value="EVENT"/>

        <field name="Filter" locator="/transaction/action/text()[. = 'started']" locator-type="Label" required="true"/>
        <field name="EventName" value="Started"/>
        <field name="UserName" locator="/transaction/originator/userID" locator-type="Label"/>
        <field name="Location" locator="/transaction/originator/hostName" locator-type="Label"/>
        <field name="ApplName" separator=":">
            <field-locator value="JOB"/>
            <field-locator locator="/transaction/job/name" locator-type="Label" required="false"/>
        </field>
        <field name="ResourceMgr" locator="/transaction/sourceAgent/@QMgr" locator-type="Label"/>
        <field name="ResMgrType" value="MESSAGING_SERVER"/>
        <field name="ServerName" locator="/transaction/originator/hostName" locator-type="Label"/>
        <field name="ServerOs" locator="/transaction/sourceAgent/systemInfo/@name" locator-type="Label"/>
        <field name="StartTime" locator="/transaction/action/@time" locator-type="Label" datatype="DateTime"
               format="yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" timezone="GMT"/>
    </parser>

    <parser name="CompletedEventParser" class="com.jkoolcloud.tnt4j.streams.parsers.MessageActivityXmlParser">
        <property name="SignatureDelim" value="#!#"/>
        <property name="RequireDefault" value="true"/>

        <field name="EventType" value="END"/>

        <field name="Filter" locator="/transaction/action/text()[. = 'completed']" locator-type="Label" required="true"/>
        <field name="EventName" value="completed"/>
        <field name="UserName" locator="/transaction/originator/userID" locator-type="Label"/>
        <field name="Location" locator="/transaction/originator/hostName" locator-type="Label"/>
        <field name="ApplName" separator=":">
            <field-locator value="JOB"/>
            <field-locator locator="/transaction/job/name" locator-type="Label" required="false"/>
        </field>
        <field name="ResourceMgr" locator="/transaction/sourceAgent/@QMgr" locator-type="Label"/>
        <field name="ResMgrType" value="MESSAGING_SERVER"/>

        <!-- Map fields from mft_trf status "completed"-->
        <field name="Message" separator="">
            <field-locator locator="/transaction/status/supplement" locator-type="Label" required="false"/>
        </field>
        <field name="ServerName" locator="/transaction/originator/hostName" locator-type="Label"/>
        <field name="ServerOs" locator="/transaction/sourceAgent/systemInfo/@name" locator-type="Label"/>
        <field name="StartTime" locator="/transaction/action/@time" locator-type="Label" datatype="DateTime"
               format="yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" timezone="GMT"/>
        <field name="ReasonCode" separator="">
            <field-locator locator="/transaction/status/@resultCode" locator-type="Label" datatype="Number"/>
        </field>
        <field name="CompCode" locator="/transaction/status/@resultCode" locator-type="Label">
            <field-map source="0" target="SUCCESS"/>
            <field-map source="40" target="WARNING"/>
            <field-map source="" target="ERROR"/>
        </field>
        <field name="CompCode2" locator="/transaction/status/@resultCode" locator-type="Label">
            <field-map source="0" target="SUCCESS"/>
            <field-map source="40" target="WARNING"/>
            <field-map source="1" target="FAILURE"/>
            <field-map source="" target="ERROR"/>
        </field>
        <field name="Exception" separator="">
            <field-locator locator="/transaction/status/supplement" locator-type="Label" required="false"/>
        </field>
    </parser>

    <stream name="WmqStream" class="com.jkoolcloud.tnt4j.streams.inputs.WmqStream">
        <property name="Host" value="localhost"/>
        <property name="Port" value="1414"/>
        <property name="Channel" value="SYSTEM.DEF.SVRCONN"/>
        <property name="QueueManager" value="QMGR.NAME"/>
        <property name="Queue" value="FTE.TRANSFER.LOG"/>

        <parser-ref name="StartedEventParser"/>
        <parser-ref name="ProgressEventParser"/>
        <parser-ref name="CompletedEventParser"/>

        <reference name="WmqStreamOutput"/>
    </stream>

    <!--<stream name="WmqStream" class="com.jkoolcloud.tnt4j.streams.inputs.CharacterStream">-->
    <!--<property name="FileName" value="./tnt4j-streams-wmq/samples/mft_fte/file/message_*_progress.xml"/>-->

    <!--&lt;!&ndash; <parser-ref name="StartedEventParser"/> &ndash;&gt;-->
    <!--<parser-ref name="ProgressEventParser"/>-->
    <!--&lt;!&ndash;<parser-ref name="CompletedEventParser"/>&ndash;&gt;-->

    <!--<reference name="WmqStreamOutput"/>-->
    <!--</stream>-->
</tnt-data-source>